name: Generate Sitemap

on:
  push:
    branches:
      - main
  # Optional: also run on schedule to keep sitemap fresh
  schedule:
    - cron: '0 0 * * 0' # Weekly on Sundays

jobs:
  sitemap_job:
    runs-on: ubuntu-latest
    name: Generate and commit sitemap
    
    # IMPORTANT: Grant write permissions
    permissions:
      contents: write
    
    steps:
      # Step 1: Check out your repository's code
      - name: Checkout the repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # Use the GITHUB_TOKEN for authentication
          token: ${{ secrets.GITHUB_TOKEN }}
      
      # Step 2: Generate the sitemap file
      - name: Generate the sitemap
        uses: cicirello/generate-sitemap@v1
        with:
          base-url-path: https://www.reelikklemind.com/
          include-html: true
          include-pdf: false
          
      # Step 3: Commit the new sitemap.xml file
      - name: Commit sitemap
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: Auto-generate sitemap"
          file_pattern: sitemap.xml
          commit_user_name: github-actions[bot]
          commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com
